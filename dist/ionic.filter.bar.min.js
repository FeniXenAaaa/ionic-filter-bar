angular.module("jett.ionic.filter.bar",["ionic"]),function(e,t){"use strict";e.module("jett.ionic.filter.bar").directive("ionFilterBar",["$timeout","$ionicGesture","$ionicPlatform",function(o,n,r){var i;return i=r.is("android")?'<div class="filter-bar-wrapper filter-bar-{{::config.theme}} filter-bar-transition-{{::config.transition}}"><div class="bar bar-header bar-{{::config.theme}} item-input-inset"><button class="filter-bar-cancel button button-icon icon {{::config.back}}"></button><label class="item-input-wrapper"><input type="search" class="filter-bar-search" ng-model="data.filterText" placeholder="{{::config.placeholder}}" /><button class="filter-bar-clear button button-icon icon" ng-class="getClearButtonClass()"></button></label></div></div>':'<div class="filter-bar-wrapper filter-bar-{{::config.theme}} filter-bar-transition-{{::config.transition}}"><div class="bar bar-header bar-{{::config.theme}} item-input-inset"><label class="item-input-wrapper"><i class="icon {{::config.search}} placeholder-icon"></i><input type="search" class="filter-bar-search" ng-model="data.filterText" placeholder="{{::config.placeholder}}"/><button class="filter-bar-clear button button-icon icon" ng-class="getClearButtonClass()"></button></label><button class="filter-bar-cancel button button-clear" ng-bind-html="::cancelText"></button></div></div>',{restrict:"E",scope:!0,link:function(r,i){var a,c,l,s,d,f=i[0],u=f.querySelector(".filter-bar-clear"),m=f.querySelector(".filter-bar-cancel"),p=f.querySelector(".filter-bar-search"),h=function(){r.cancelFilterBar()};r.config.backdrop&&(l=e.element('<div class="filter-bar-backdrop"></div>'),i.append(l),s=function(e){e.target==l[0]&&h()},l.bind("click",s),c=n.on("swipe",s,l)),r.favoritesEnabled?r.getClearButtonClass=function(){return r.data.filterText.length?r.config.clear:r.config.favorite}:r.getClearButtonClass=function(){return r.data.filterText.length?r.config.clear:"filter-bar-element-hide"};var b=function(){u.classList.contains(r.config.favorite)?r.showModal():o(function(){r.data.filterText="",ionic.requestAnimationFrame(function(){r.showBackdrop(),r.scrollItemsTop(),r.focusInput()})})},g=function(){r.scrollItemsTop(),r.focusInput()},v=function(e){27==e.which?h():r.data.filterText&&r.data.filterText.length?r.hideBackdrop():r.showBackdrop()};m.addEventListener("mousedown",function(e){e.stopImmediatePropagation(),h()}),m.addEventListener("touchstart",function(e){e.stopImmediatePropagation(),h()}),u.addEventListener("touchstart",b),u.addEventListener("mousedown",b),p.addEventListener("touchstart",g),p.addEventListener("mousedown",g),t.addEventListener("keyup",v);var $=function(){r.filterItems(r.data.filterText)};r.$on("$destroy",function(){i.remove(),t.removeEventListener("keyup",v),l&&n.off(c,"swipe",s),d()}),d=r.$watch("data.filterText",function(e,t){var n;a&&o.cancel(a),e!==t&&(n=e.length&&r.debounce?r.delay:0,a=o($,n,!1))})},template:i}}])}(angular,document),function(e){"use strict";e.module("jett.ionic.filter.bar").provider("$ionicFilterBarConfig",function(){function t(e,t){c.platform[e]=t,i.platform[e]={},o(c,c.platform[e]),n(c.platform[e],i.platform[e],"")}function o(t,n){for(var r in t)r!=a&&t.hasOwnProperty(r)&&(e.isObject(t[r])?(e.isDefined(n[r])||(n[r]={}),o(t[r],n[r])):e.isDefined(n[r])||(n[r]=null))}function n(t,o,i){e.forEach(t,function(l,s){e.isObject(t[s])?(o[s]={},n(t[s],o[s],i+"."+s)):o[s]=function(e){if(arguments.length)return t[s]=e,o;if(t[s]==a){var n=r(c.platform,ionic.Platform.platform()+i+"."+s);return n||n===!1?n:r(c.platform,"default"+i+"."+s)}return t[s]}})}function r(t,o){o=o.split(".");for(var n=0;n<o.length;n++){if(!t||!e.isDefined(t[o[n]]))return null;t=t[o[n]]}return t}var i=this;i.platform={};var a="platform",c={theme:a,clear:a,add:a,close:a,done:a,remove:a,reorder:a,favorite:a,search:a,backdrop:a,transition:a,platform:{},placeholder:a};n(c,i,""),t("default",{clear:"ion-ios-close",add:"ion-ios-plus-outline",close:"ion-ios-close-empty",done:"ion-ios-checkmark-empty",remove:"ion-ios-trash-outline",reorder:"ion-drag",favorite:"ion-ios-star",search:"ion-ios-search-strong",backdrop:!0,transition:"vertical",placeholder:"Search"}),t("ios",{}),t("android",{clear:"ion-android-close",close:"ion-android-close",done:"ion-android-done",remove:"ion-android-delete",favorite:"ion-android-star",search:!1,backdrop:!1,transition:"horizontal"}),i.setPlatformConfig=t,i.$get=function(){return i}})}(angular),function(e,t){"use strict";var o='<ion-modal-view ng-controller="$ionicFilterBarModalCtrl" class="filter-bar-modal"><ion-header-bar class="bar bar-{{::config.theme}} disable-user-behavior"><button class="button button-icon {{::config.close}}" ng-click="closeModal()"></button><h1 class="title" ng-bind-html="::favoritesTitle"></h1><button ng-if="searches.length > 1" class="button button-icon" ng-class="displayData.showReorder ? config.done : config.reorder" ng-click="displayData.showReorder = !displayData.showReorder"></button></ion-header-bar><ion-content><ion-list show-reorder="displayData.showReorder" delegate-handle="searches-list"><ion-item ng-repeat="item in searches" class="item-remove-animate" ng-class="{reordered: item.reordered}" ng-click="itemClicked(item.text, $event)"><span ng-bind-html="item.text"></span><ion-option-button class="button-assertive icon {{::config.remove}}" ng-click="deleteItem(item)"></ion-option-button><ion-reorder-button class="{{::config.reorder}}" on-reorder="moveItem(item, $fromIndex, $toIndex)"></ion-reorder-button></ion-item><div class="item item-input"><input type="text" ng-model="newItem.text" placeholder="{{::favoritesAddPlaceholder}}"/><button class="button button-icon icon {{::config.add}}" ng-click="addItem(newItem)"></button></div></ion-list></ion-content> </ion-modal-view>',n=function(e){var t=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],o=e&&e.classList;if(o)for(var n=0;n<t.length;n++)if(o.contains("bar-"+t[n]))return t[n]};e.module("jett.ionic.filter.bar").factory("$ionicFilterBar",["$document","$rootScope","$compile","$timeout","$filter","$ionicPlatform","$ionicFilterBarConfig","$ionicConfig","$ionicModal","$ionicScrollDelegate",function(r,i,a,c,l,s,d,f,u,m){function p(r){if(!h){h=!0,r=r||{};var d=i.$new(!0),f=!1,p=!1;r.container&&(r.container=b.querySelector(r.container)),e.extend(d,{config:g,$deregisterBackButton:e.noop,update:e.noop,cancel:e.noop,done:e.noop,scrollDelegate:m,filter:l("filter"),filterProperties:null,expression:null,comparator:null,debounce:!0,delay:300,cancelText:"Cancel",cancelOnStateChange:!0,container:b,favoritesTitle:"Favorite Searches",favoritesAddPlaceholder:"Add a search term",favoritesEnabled:!1,favoritesKey:"ionic_filter_bar_favorites"},r),d.data={filterText:""},d.config.theme||(d.config.theme=n(d.container.querySelector(".bar.bar-header")));var v=d.element=a('<ion-filter-bar class="filter-bar"></ion-filter-bar>')(d),$=v.children().eq(0),w=$.find("input")[0],B=v.children().eq(1),k=d.scrollDelegate.getScrollView(),y=!!k,I=y?k.__container:null,x=d.cancelOnStateChange?i.$on("$stateChangeSuccess",function(){d.cancelFilterBar()}):e.noop,T=function(){p||(p=!0,w&&w.focus())},C=function(){p&&(p=!1,w&&w.blur())},F=function(){k.__scrollTop>0&&C()};return d.scrollItemsTop=function(){y&&k.__scrollTop>0&&d.scrollDelegate.scrollTop&&d.scrollDelegate.scrollTop()},d.focusInput=function(){p=!1,T()},d.hideBackdrop=function(){B.length&&f&&(f=!1,B.removeClass("active").css("display","none"))},d.showBackdrop=function(){B.length&&!f&&(f=!0,B.css("display","block").addClass("active"))},d.showModal=function(){d.modal=u.fromTemplate(o,{scope:d}),d.modal.show()},d.filterItems=function(t){var o,n;t.length?(d.expression?o=e.bind(this,d.expression,t):e.isArray(d.filterProperties)?(o={},e.forEach(d.filterProperties,function(e){o[e]=t})):d.filterProperties?(o={},o[d.filterProperties]=t):o=t,n=d.filter(d.items,o,d.comparator)):n=d.items,c(function(){d.update(n,t),d.scrollItemsTop()})},d.$deregisterBackButton=s.registerBackButtonAction(function(){c(d.cancelFilterBar)},300),d.removeFilterBar=function(o){d.removed||(d.removed=!0,t.requestAnimationFrame(function(){$.on("transitionend",function t(){C(),d.hideBackdrop(),$[0].off("transitionend",t)}),$.removeClass("filter-bar-in"),c(function(){d.scrollItemsTop(),d.update(d.items),d.$destroy(),v.remove(),d.cancelFilterBar.$scope=d.modal=I=k=$=B=w=null,h=!1,(o||e.noop)()},350)}),c(function(){d.container.classList.remove("filter-bar-open")},400),d.$deregisterBackButton(),x(),I&&I.removeEventListener("scroll",F))},d.showFilterBar=function(o){d.removed||(d.container.appendChild(v[0]),d.container.classList.add("filter-bar-open"),d.scrollItemsTop(),t.requestAnimationFrame(function(){d.removed||c(function(){$.addClass("filter-bar-in"),$.on("transitionend",function t(){$.off("transitionend",t),d.focusInput(),d.showBackdrop(),(o||e.noop)()})},20,!1)}),I&&I.addEventListener("scroll",F))},d.cancelFilterBar=function(){d.removeFilterBar(d.cancel)},d.showFilterBar(d.done),d.cancelFilterBar.$scope=d,d.cancelFilterBar}}var h=!1,b=r[0].body,g={theme:d.theme(),transition:d.transition(),back:f.backButton.icon(),clear:d.clear(),favorite:d.favorite(),search:d.search(),backdrop:d.backdrop(),placeholder:d.placeholder(),close:d.close(),done:d.done(),reorder:d.reorder(),remove:d.remove(),add:d.add()};return{show:p}}])}(angular,ionic),function(e){"use strict";e.module("jett.ionic.filter.bar").controller("$ionicFilterBarModalCtrl",["$window","$scope","$timeout","$ionicListDelegate",function(t,o,n,r){var i=o.$parent.favoritesKey;o.displayData={showReorder:!1},o.searches=e.fromJson(t.localStorage.getItem(i))||[],o.newItem={text:""},o.moveItem=function(e,t,r){e.reordered=!0,o.searches.splice(t,1),o.searches.splice(r,0,e),n(function(){delete e.reordered},500)},o.deleteItem=function(e){var t=o.searches.indexOf(e);o.searches.splice(t,1)},o.addItem=function(){o.newItem.text&&(o.searches.push({text:o.newItem.text}),o.newItem.text="")},o.closeModal=function(){t.localStorage.setItem(i,e.toJson(o.searches)),o.$parent.modal.remove()},o.itemClicked=function(e,t){var n=!!t.currentTarget.querySelector(".item-options.invisible");n?(o.closeModal(),o.$parent.hideBackdrop(),o.$parent.data.filterText=e,o.$parent.filterItems(e)):r.$getByHandle("searches-list").closeOptionButtons()}}])}(angular);